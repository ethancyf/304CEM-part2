<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Color Picker</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1"><!--熒幕-->
		<link href="bootstrap.css" rel="stylesheet" type="text/css"><!-- bootstrap -->
		<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"><!--body font-->
		<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css"><!--menu font-->
		<link href="myfav.css" rel="stylesheet" type="text/css"><!--main css -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
		<script defer src="https://use.fontawesome.com/releases/v5.10.2/js/all.js"></script>
		<script type="text/javascript" src="colorset.json"></script>
		
	</head>
	<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="50" onkeydown="keyLogin()">	
		<!--	//////////////////MENU//////////////////////-->
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#myPage">Color Picker</a>
				</div>
				<div class="collapse navbar-collapse" id="myNavbar">
				<!--	//////////////////MENU-MORE//////////////////////-->
					<ul class="nav navbar-nav navbar-right" id="menumore">
						<li class="dropdown">
							<a class="dropdown-toggle" data-toggle="dropdown" href="#" id="menutext">User<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li><a href="/changepassword.html">Change Password</a></li>
								<li  id="export" data-toggle="modal"  data-target="#Export"><a href="#Export">Export</a></li>
								<li id="menulogout"><a href="#Logout">Logout</a></li> 
							</ul>
						</li>
					</ul>
			<!--	//////////////////MENU-MAIN//////////////////////-->
					<ul class="nav navbar-nav navbar-right">
						<li>
							<a href="/index.html">HOME</a>
						</li>
						<li>
							<a href="#theory">COLOR THEORY</a>
						</li>
						<li>
							<a href="/myfav.html">COLOR PETTELLE</a>
						</li>
						<li>
							"　　　　　"
						</li>
						<li id="menulogin" data-toggle="modal"  data-target="#Login">
							<a href="#Login">LOGIN</a>
						</li>

					</ul>
				</div>
			</div>
		</nav>
		<div class="container text-center">
			<table class="titlebanner">
				<tr>
					<th colspan="2">
						<h7>Color Picker</h7>
					</th>
				</tr>
				<tr>
					<th>
						<div class="divider"></div>
					</th>
					<th>
						<h5>01</h5><br>
						 <h6>Color Pettelle</h6>
					</th>
				</tr>
			</table>
		</div>	
		<div class="bg-1">
			<div class="container">
				<h8>Pettelle</h8>
				<ul class="list-group">
					<ul class="nav nav-tabs">
						<li class="active"><a data-toggle="tab" href="#home">All</a></li>
						<li><a data-toggle="tab" href="#menu1">My</a></li>
					</ul>
					<div class="tab-content">
						<div id="home" class="tab-pane fade in active">
							<div class="row text-center">
								<p></p><p id='home1.0'></p><p id='home1.1'></p><p id='home1.2'></p><p id='home1.3'></p><p id='home1.4'></p><p id='home1.5'></p><p id='home1.6'></p><p id='home1.7'></p><p id='home1.8'></p><p id='home1.9'></p><p id='home1.10'></p><p id='home1.11'></p><p id='home1.12'></p><p id='home1.13'></p><p id='home1.14'></p><p id='home1.15'></p><p id='home1.16'>	</p><p id='home1.17'></p><p id='home1.18'></p><p id='home1.19'></p><p id='home1.20'></p><p id='home1.21'></p><p id='home1.22'></p><p id='home1.23'></p><p id='home1.24'></p><p id='home1.25'></p><p id='home1.26'></p><p id='home1.27'></p><p id='home1.28'></p><p id='home1.29'></p><p id='home1.30'></p><p id='home1.31'></p><p id='home1.32'></p><p id='home1.33'></p><p id='home1.34'></p><p id='home1.35'></p><p id='home1.36'></p><p id='home1.37'></p><p id='home1.38'></p><p id='home1.39'></p><p id='home1.40'></p><p id='home1.41'></p><p id='home1.42'></p><p id='home1.43'></p>
							</div> 
						</div>
						<div id="menu1" class="tab-pane fade">
							<div class="row text-center">
								<p></p><p id='memu1.0'></p><p id='memu1.1'></p><p id='memu1.2'></p><p id='memu1.3'></p><p id='memu1.4'></p><p id='memu1.5'></p><p id='memu1.6'></p><p id='memu1.7'></p><p id='memu1.8'></p><p id='memu1.9'></p><p id='memu1.10'></p><p id='memu1.11'></p><p id='memu1.12'></p><p id='memu1.13'></p><p id='memu1.14'></p><p id='memu1.15'></p><p id='memu1.16'></p><p id='memu1.17'></p><p id='memu1.18'></p><p id='memu1.19'></p><p id='memu1.20'></p><p id='memu1.21'></p><p id='memu1.22'></p><p id='memu1.23'></p><p id='memu1.24'></p><p id='memu1.25'></p><p id='memu1.26'></p><p id='memu1.27'></p><p id='memu1.28'></p><p id='memu1.29'></p><p id='memu1.30'></p><p id='memu1.31'></p><p id='memu1.32'></p><p id='memu1.33'></p><p id='memu1.34'></p><p id='memu1.35'></p><p id='memu1.36'></p><p id='memu1.37'></p><p id='memu1.38'></p><p id='memu1.39'></p><p id='memu1.40'></p><p id='memu1.41'></p><p id='memu1.42'></p><p id='memu1.43'></p>
							</div> 
						</div>
					</div>
				</ul>
			</div>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script type="text/javascript">
			var colorset = [];
			var usercolorset = [];
			$( document ).ready(function() {
						///////////////////////Login///////////////	
			$("#loginbtn").click(function(){
			var loginname=$("#loginname").val();
			var password=$("#password").val();
			if(loginname!="" & password!=""){
			var mydata="loginname="+loginname+"&password="+password;
			$.ajax({
				type: 'POST',
			url: 'http://127.0.0.1:9999/login',
			dataType:"text",
			data:mydata,
				success: function(data) { 
				if (data == "success"){
						document.getElementById("menulogin").style = "display:none";
						document.getElementById("menulogout").style = "";
						localStorage.setItem("user",loginname);
						location.href="/index.html";	
						alert("Login Success");
					} else {	
						alert("Login Fail");
				}
			}
			});
			}else{				
			alert("Please enter the email and password");
			}
			});
				///////////////////checkLocalStorage//////////////////
				checkLocalStorage();
				///////////////////checkLocalStorageFunction//////////////////
				function checkLocalStorage(){
					if(localStorage.getItem("user") != null){
						document.getElementById("menulogin").style = "display:none";
						document.getElementById("menumore").style = "";
						document.getElementById("menulogout").style = "";
						var localuser = localStorage.getItem('user')
						document.getElementById('menutext').innerHTML = 'Welcome, '+ localuser + '<span class="caret"></span>' ;
					}else{
						document.getElementById("menulogin").style = "";
						document.getElementById("menumore").style = "display:none";
						document.getElementById("menulogout").style = "display:none";
					}
				}
				/////////////////////////////Get colorset/////////////////////////
				$.ajax({
					type: 'POST',
					url: 'http://127.0.0.1:9999/favurl',
					dataType:"text",
					data:"123",
					success: function(data) {
						var url = data;
				$.ajax({
					type: 'GET',
					url: url,
					dataType:"json",
					data:"",
					success: function(data) {	
						for(i = 0; i < data.length; i++) { 		
							document.getElementById("home1."+i).innerHTML = '<div class="col-sm-4"><div class="thumbnail"><table class="colorsettable" id="colorsetcode"><tr><th><div class="colorset" id="color0-0" style="background:'+ data[i].color0 + ';"></div></th><th><div class="colorset" id="color0-1" style="background: '+ data[i].color1 + ';"></div></th><th><div class="colorset" id="color0-2" style="background: '+ data[i].color2 + ';"></div></th><th><div class="colorset" id="color0-3" style="background: '+ data[i].color3 + ';"></div></th><th><div class="colorset" id="color0-4" style="background: '+ data[i].color4 + ';"></div></th></tr></table><table class="colorsettable" id="colorsetcode"><tr><th><button type="button" class="btn btn-block" onclick="saveFunction(this.id)" id="'+[i]+'">Save <i class="fas fa-heart" id="saveicon'+[i]+'" data-fa-transform="down-1"></i></button></th><th><button type="button" class="btn btn-block" onclick="infoFunction(this.id)" id="'+[i]+'">Info <i class="fas fa-info" id="infoicon'+[i]+'" ></i></button></th></tr></table></div></div>';
							colorset[i] = data[i].color0+","+data[i].color1+","+data[i].color2+","+data[i].color3+","+data[i].color4;
						}
						
					}
				});
					}
				});
				
				var localuser = localStorage.getItem("user");
				if (localuser != null){
					var mydata = "loginname:" + localuser;
					$.ajax({
					type: 'POST',
					url: 'http://127.0.0.1:9999/getuserfav',
					dataType:"json",
					data:mydata,
					success: function(data) {	
						for(i = 0; i < data.length; i++) { 		
							document.getElementById("memu1."+i).innerHTML = '<div class="col-sm-4"><div class="thumbnail"><table class="colorsettable" id="colorsetcode"><tr><th><div class="colorset" id="color0-0" style="background:'+ data[i].color0 + ';"></div></th><th><div class="colorset" id="color0-1" style="background: '+ data[i].color1 + ';"></div></th><th><div class="colorset" id="color0-2" style="background: '+ data[i].color2 + ';"></div></th><th><div class="colorset" id="color0-3" style="background: '+ data[i].color3 + ';"></div></th><th><div class="colorset" id="color0-4" style="background: '+ data[i].color4 + ';"></div></th></tr></table><table class="colorsettable" id="colorsetcode"><tr><th><button type="button" class="btn btn-block" onclick="delFunction(this.id)" id="'+[i]+'">Delete <i class="fas fa-trash-alt"></i></button></th><th><button type="button" class="btn btn-block" onclick="infoFunction(this.id)">Info <i class="fas fa-info"></i></button></th></tr></table></div></div>';
							usercolorset[i] = data[i].color0+","+data[i].color1+","+data[i].color2+","+data[i].color3+","+data[i].color4;
						}
					}
				});
				} 
			});
			
			
			/////////////////////Save fav function///////////////////
			function saveFunction(clicked_id){
				var localuser = localStorage.getItem("user");
				if (localuser != null){
					var mydata = "loginname:" + localuser + "&" + "colorset:" + colorset[clicked_id];
					$.ajax({
						type: 'POST',
						url: 'http://127.0.0.1:9999/insertfav',
						dataType:"text",
						data:mydata,
						success: function(data) {
							$.ajax({
					type: 'POST',
					url: 'http://127.0.0.1:9999/getuserfav',
					dataType:"json",
					data:mydata,
					success: function(data) {	
						for(i = 0; i < data.length; i++) { 		
							document.getElementById("memu1."+i).innerHTML = '<div class="col-sm-4"><div class="thumbnail"><table class="colorsettable" id="colorsetcode"><tr><th><div class="colorset" id="color0-0" style="background:'+ data[i].color0 + ';"></div></th><th><div class="colorset" id="color0-1" style="background: '+ data[i].color1 + ';"></div></th><th><div class="colorset" id="color0-2" style="background: '+ data[i].color2 + ';"></div></th><th><div class="colorset" id="color0-3" style="background: '+ data[i].color3 + ';"></div></th><th><div class="colorset" id="color0-4" style="background: '+ data[i].color4 + ';"></div></th></tr></table><table class="colorsettable" id="colorsetcode"><tr><th><button type="button" class="btn btn-block" onclick="delFunction(this.id)" id="'+[i]+'">Delete <i class="fas fa-trash-alt"></i></button></th><th><button type="button" class="btn btn-block" onclick="infoFunction(this.id)">Info <i class="fas fa-info"></i></button></th></tr></table></div></div>';
							usercolorset[i] = data[i].color0+","+data[i].color1+","+data[i].color2+","+data[i].color3+","+data[i].color4;
						}
					}
				});
							if(data == "saved"){
								alert(data);
								document.getElementById("saveicon"+[clicked_id]).style = "color:red";
							}else{
								alert("deleted")
								document.getElementById("saveicon"+[clicked_id]).style = "";
							}
						}
					});
				}else{
					alert("Please Login");
					
				}
			}
			
			
			
			function delFunction(clicked_id){
				var localuser = localStorage.getItem("user");
				var mydata = "loginname:" + localuser + "&colorset:" + usercolorset[clicked_id];
					$.ajax({
						type: 'POST',
						url: 'http://127.0.0.1:9999/delfav',
						dataType:"text",
						data:mydata,
						success: function(data) {
							if(data == "deleted"){

					var localuser = localStorage.getItem("user");
					var mydata = "loginname:" + localuser;
					$.ajax({
					type: 'POST',
					url: 'http://127.0.0.1:9999/getuserfav',
					dataType:"json",
					data:mydata,
					success: function(data) {
						if(data!="null"){
						for(i = 0; i < 44; i++) { 
						document.getElementById("memu1."+i).innerHTML = '';
						}
						for(i = 0; i < data.length; i++) { 		
							document.getElementById("memu1."+i).innerHTML = '<div class="col-sm-4"><div class="thumbnail"><table class="colorsettable" id="colorsetcode"><tr><th><div class="colorset" id="color0-0" style="background:'+ data[i].color0 + ';"></div></th><th><div class="colorset" id="color0-1" style="background: '+ data[i].color1 + ';"></div></th><th><div class="colorset" id="color0-2" style="background: '+ data[i].color2 + ';"></div></th><th><div class="colorset" id="color0-3" style="background: '+ data[i].color3 + ';"></div></th><th><div class="colorset" id="color0-4" style="background: '+ data[i].color4 + ';"></div></th></tr></table><table class="colorsettable" id="colorsetcode"><tr><th><button type="button" class="btn btn-block" onclick="delFunction(this.id)" id="'+[i]+'">Delete <i class="fas fa-trash-alt"></i></button></th><th><button type="button" class="btn btn-block" onclick="infoFunction(this.id)">Info <i class="fas fa-info"></i></button></th></tr></table></div></div>';
							usercolorset[i] = data[i].color0+","+data[i].color1+","+data[i].color2+","+data[i].color3+","+data[i].color4;
						}
							}else{
								for(i = 0; i < 44; i++) { 
									document.getElementById("memu1."+i).innerHTML = '';
								}
								}
					}
				});
							}else{
								alert("deleted")
								document.getElementById("saveicon"+[clicked_id]).style = "";
							}
						}
					});	
			}

			
						/////////////////////open color info function///////////////////
			function infoFunction(clicked_id){
				var a = [];
				color = colorset[clicked_id].split(",");
				for(i = 0; i < color.length; i++) { 		
				var d = color[i].split("#");
				a[i] = d[1];
				localStorage.setItem("color"+[i],a[i]);
				}
				location.href="http://127.0.0.1:9999/info.html";
			}
			

				//////////////////logout//////////////////
				$("#menulogout").click(function(){
					document.getElementById("menulogin").style = "";
					document.getElementById("menumore").style = "display:none";
					document.getElementById("menulogout").style = "display:none";
					localStorage.clear();
				});
				//////////////////////END///////////////////////
			
			/////////////////////Export Color////////////////////
			$("#export").click(function(){
				var localuser = localStorage.getItem("user");
					var mydata = "loginname:" + localuser;
					$.ajax({
					type: 'POST',
					url: 'http://127.0.0.1:9999/getuserfav',
					dataType:"json",
					data:mydata,
					success: function(data) {
						var myobj = JSON.stringify(data);

							$.ajax({
								url: "https://api.myjson.com/bins",
								type: "POST",
								data: myobj,
								contentType: "application/json; charset=utf-8",
								dataType: "json",
								success: function (data, textStatus, jqXHR) {
									var json = JSON.stringify(data);
									var url = json.substring(8,json.length - 2);
									$("#url").val(url);
								}
							});
						
						
						
					}
				});
			});
				//////////////////////END///////////////////////
</script>
		
		
		<!--/////////////////Login Form//////////////////////-->
	<div class="modal fade" id="Login" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4><i class="fas fa-sign-in-alt"></i> Login</h4>
				</div>
				<div class="modal-body">
					<form role="form">
						<div class="form-group">
							<label for="text"><i class="fas fa-user"></i> Login name</label>
							<input type="email" class="form-control" id="loginname" placeholder="Enter email">
						</div>
						<div class="form-group">
							<label for="text"><i class="fas fa-key"></i> Password</label>
							<input type="password" class="form-control" id="password" placeholder="Enter password">
						</div>
						<button type="button" class="btn btn-block" id="loginbtn"><i class="fas fa-unlock-alt"></i> Submit</button>
					</form>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal">
						<i class="fas fa-ban"></i> Cancel</button>
					<p>No account yet?　<a href="/signup">Sign up</a></p>
				</div>
			</div>
		</div>
	</div>
		<!--/////////////////Export Form//////////////////////-->
		<div class="modal fade" id="Export" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4><i class="fas fa-file-export"></i> Export</h4>
				</div>
				<div class="modal-body">
					<form role="form">
						<div class="form-group">
							<label for="text">Export your favorite color by JSON</label>
						</div>
						<div class="form-group">
							<label for="text">Request Method: GET</label>
						</div>

						<button type="button" class="btn btn-block" id="export"><i class="fas fa-unlock-alt"></i> Export</button>
						<div class="form-group">
							<label for="text"><i class="fas fa-link"></i> URL:</label>
							<input type="url" class="form-control" id="url" placeholder="URL">
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal">
						<i class="fas fa-ban"></i> Cancel</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>




 